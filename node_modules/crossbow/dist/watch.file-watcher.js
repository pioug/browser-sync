"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var seq = require("./task.sequence");
var task_runner_1 = require("./task.runner");
var Rx = require("rx");
var reporter_resolve_1 = require("./reporter.resolve");
var command_watch_1 = require("./command.watch");
var immutable_1 = require("immutable");
var debug = require("debug")("cb:watch.runner");
/**
 * Create a stream that is the combination of all watchers
 */
function createObservablesForWatchers(watchers, trigger) {
    var _a;
    /**
     * Wrap every chokidar watcher in an observable
     * @type {Rx.Observable<WatchEvent>[]}
     */
    var _nonGrouped = watchers.filter(function (watcher) { return watcher.options.group === 0; });
    var _grouped = watchers.filter(function (watcher) { return watcher.options.group > 0; });
    var watchersAsObservablesNonGrouped = _nonGrouped
        .map(function (watcher) {
        return createObservableForWatcher(watcher, trigger);
    });
    var watchersAsObservablesGrouped = _grouped
        .map(function (watcher) {
        return createObservableForWatcher(watcher, trigger);
    });
    var blockable$ = new Rx.BehaviorSubject([]);
    /**
     * Now map file-change events to task running
     */
    return (_a = Rx.Observable).merge.apply(_a, watchersAsObservablesNonGrouped.concat(watchersAsObservablesGrouped)).filter(function (x) {
        if (x.watcher.options.block) {
            var blocked = !~blockable$.getValue().indexOf(x.watcher.watcherUID);
            if (x.watchEvent) {
                debug("BLOCKED - " + x.watcher.watcherUID + " " + x.watchEvent.path + " " + x.watchEvent.event);
            }
            else {
                x.watchEvents.forEach(function (watchEvent) {
                    debug("BLOCKED - " + x.watcher.watcherUID + " " + watchEvent.path + " " + watchEvent.event);
                });
            }
            return blocked;
        }
        return true;
    })
        .do(function (x) {
        if (x.watcher.options.block) {
            blockable$.onNext(blockable$.getValue().concat(x.watcher.watcherUID));
        }
    })
        .timestamp(trigger.config.scheduler)
        .flatMap(function (incoming, i) {
        return runTasks(incoming, i);
    });
    function runTasks(incoming, i) {
        /**
         * @type {WatchEvent}
         */
        var _a = incoming.value, watchEvent = _a.watchEvent, watcher = _a.watcher, _b = _a.watchEvents, watchEvents = _b === void 0 ? [] : _b;
        return Rx.Observable.create(function (obs) {
            /**
             * Report start of task run
             */
            trigger.reporter({
                type: reporter_resolve_1.ReportTypes.WatcherTriggeredTasks,
                data: {
                    index: i,
                    taskCollection: watcher.tasks
                }
            });
            /**
             * todo: Is there a way to handle this without subscribing manually?
             */
            watcher._runner.series(immutable_1.fromJS({
                watchEvent: watchEvent,
                watchEvents: watchEvents,
                watcher: {
                    patterns: watcher.patterns,
                    tasks: watcher.tasks,
                    options: watcher.options,
                    watcherUID: watcher.watcherUID
                }
            }))
                .do(function (taskReport) {
                var data = {
                    taskReport: taskReport,
                    watchEvent: watchEvent,
                    watchEvents: watchEvents,
                    count: i
                };
                obs.onNext({
                    type: command_watch_1.WatchCommandEventTypes.WatchTaskReport,
                    data: data,
                });
            })
                .toArray()
                .timestamp(trigger.config.scheduler)
                .subscribe(function (x) {
                var reports = x.value;
                var sequence = seq.decorateSequenceWithReports(watcher._sequence, reports);
                var errors = reports.filter(function (x) { return x.type === task_runner_1.TaskReportType.error; });
                var data = {
                    sequence: sequence,
                    reports: reports,
                    errors: errors,
                    watchEvent: watchEvent,
                    watchEvents: watchEvents,
                    runtime: x.timestamp - incoming.timestamp
                };
                obs.onNext({
                    type: command_watch_1.WatchCommandEventTypes.WatchRunnerComplete,
                    data: data,
                });
                if (errors.length > 0) {
                    trigger.reporter({
                        type: reporter_resolve_1.ReportTypes.WatcherSummary,
                        data: {
                            sequence: sequence,
                            cli: trigger.cli,
                            title: watcher.tasks.join(", "),
                            config: trigger.config,
                            runtime: x.timestamp - incoming.timestamp,
                            watcher: watcher,
                            watchEvent: watchEvent,
                            watchEvents: watchEvents,
                        }
                    });
                }
                else {
                    trigger.reporter({
                        type: reporter_resolve_1.ReportTypes.WatcherTriggeredTasksCompleted,
                        data: {
                            index: i,
                            taskCollection: watcher.tasks,
                            time: x.timestamp - incoming.timestamp
                        }
                    });
                }
                var withoutThis = blockable$.getValue().filter(function (x) { return x !== watchEvent.watcherUID; });
                blockable$.onNext(withoutThis);
                obs.onCompleted();
            });
        });
    }
}
exports.createObservablesForWatchers = createObservablesForWatchers;
/**
 * Create a file-system watcher that will emit <WatchEvent>
 */
function createObservableForWatcher(watcher, trigger) {
    var reporter = trigger.reporter;
    var scheduler = trigger.config.scheduler;
    /**
     * First create a stream of file-watcher events for this Watcher
     */
    var output$ = trigger.config.fileChangeObserver || getFileChangeStream(watcher, reporter);
    if (watcher.options.group > 0) {
        return output$
            .buffer(function () { return output$.debounce(watcher.options.group, scheduler); })
            .map(function (xs) {
            return {
                watcher: watcher,
                watchEvents: xs,
            };
        });
    }
    /**
     * Specify a mapping from option name -> Rx.Observable operator name
     */
    var additionalOperators = [
        {
            option: "debounce",
            fnName: "debounce"
        },
        {
            option: "throttle",
            fnName: "throttle"
        },
        {
            option: "delay",
            fnName: "delay"
        }
    ];
    return applyOperators(output$, additionalOperators, watcher.options, scheduler)
        .map(function (x) {
        return {
            watcher: watcher,
            watchEvent: x,
        };
    });
}
exports.createObservableForWatcher = createObservableForWatcher;
function getFileChangeStream(watcher, reporter) {
    /** DEBUG **/
    debug("[id:" + watcher.watcherUID + "] options: " + JSON.stringify(watcher.options, null, 2));
    /** DEBUG END **/
    return Rx.Observable.create(function (observer) {
        /** DEBUG **/
        debug("+ [id:" + watcher.watcherUID + "] " + watcher.patterns.length + " patterns (" + watcher.patterns + ")");
        debug("\u2514\u2500 " + watcher.tasks.length + " tasks (" + watcher.tasks + ")");
        /** DEBUG END **/
        var chokidarWatcher = require("chokidar").watch(watcher.patterns, watcher.options)
            .on("all", function (event, path) {
            debug("\u2514\u2500 CHOKIDAR EVENT " + event + " - " + path);
            observer.onNext({
                event: event,
                path: path,
                watcherUID: watcher.watcherUID
            });
        });
        chokidarWatcher.on("ready", function () {
            /** DEBUG **/
            debug("\u221A [id:" + watcher.watcherUID + "] watcher ready (" + watcher.patterns + ")");
            /** DEBUG END **/
            if (Object.keys(chokidarWatcher.getWatched()).length === 0) {
                reporter({ type: reporter_resolve_1.ReportTypes.NoFilesMatched, data: { watcher: watcher } });
            }
        });
        return function () {
            debug("- for " + watcher.patterns);
            chokidarWatcher.close();
        };
    }).share();
}
exports.getFileChangeStream = getFileChangeStream;
/**
 *
 */
function applyOperators(source, items, options, scheduler) {
    return items.reduce(function (stream$, item) {
        var value = options[item.option];
        if (value !== undefined && value > 0) {
            return stream$[item.fnName].call(stream$, value, scheduler);
        }
        return stream$;
    }, source);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2F0Y2guZmlsZS13YXRjaGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3dhdGNoLmZpbGUtd2F0Y2hlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLHFDQUF1QztBQUV2Qyw2Q0FBeUQ7QUFDekQsdUJBQTBCO0FBRTFCLHVEQUE0RTtBQUU1RSxpREFBdUQ7QUFDdkQsdUNBQWlDO0FBR2pDLElBQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0FBb0NsRDs7R0FFRztBQUNILFNBQWdCLDRCQUE0QixDQUFDLFFBQW1CLEVBQUUsT0FBdUI7O0lBR3JGOzs7T0FHRztJQUNILElBQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBQSxPQUFPLElBQUksT0FBQSxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssS0FBSyxDQUFDLEVBQTNCLENBQTJCLENBQUMsQ0FBQztJQUM1RSxJQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQUEsT0FBTyxJQUFJLE9BQUEsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUF6QixDQUF5QixDQUFDLENBQUM7SUFDdkUsSUFBTSwrQkFBK0IsR0FBRyxXQUFXO1NBQzlDLEdBQUcsQ0FBQyxVQUFDLE9BQU87UUFDVCxPQUFPLDBCQUEwQixDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztJQUN4RCxDQUFDLENBQUMsQ0FBQztJQUNQLElBQU0sNEJBQTRCLEdBQUcsUUFBUTtTQUN4QyxHQUFHLENBQUMsVUFBQyxPQUFPO1FBQ1QsT0FBTywwQkFBMEIsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDeEQsQ0FBQyxDQUFDLENBQUM7SUFFUCxJQUFNLFVBQVUsR0FBRyxJQUFJLEVBQUUsQ0FBQyxlQUFlLENBQVcsRUFBRSxDQUFDLENBQUM7SUFFeEQ7O09BRUc7SUFDSCxPQUFPLENBQUEs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