"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var debug = require("debug")("cb:task.transform");
var task_resolve_1 = require("./task.resolve");
/**
 * Task Transformations
 * This gives an opportunity to change a task just before error collection
 */
exports.transforms = {
    /**
     * If an external file was matched, and it has the .sh extension,
     * load it as an @sh adaptor task
     */
    "@sh from File": {
        predicate: function (incoming) {
            return incoming.type === task_resolve_1.TaskTypes.ExternalTask &&
                incoming.externalTasks[0].parsed.ext === ".sh";
        },
        fn: function (incoming) {
            incoming.type = task_resolve_1.TaskTypes.Adaptor;
            incoming.origin = task_resolve_1.TaskOriginTypes.FileSystem;
            incoming.adaptor = "sh";
            incoming.command = ""; // Will read later
            return incoming;
        }
    }
};
/**
 * Allow transformations on tasks before error collections
 */
function applyTransforms(incoming) {
    return Object.keys(exports.transforms).reduce(function (task, key) {
        var transform = exports.transforms[key];
        if (transform.predicate(task)) {
            debug("Applying transform " + key);
            return transform.fn(task);
        }
        return incoming;
    }, incoming);
}
exports.applyTransforms = applyTransforms;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay50cmFuc2Zvcm1zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3Rhc2sudHJhbnNmb3Jtcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLElBQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0FBRXBELCtDQUEwRDtBQU8xRDs7O0dBR0c7QUFDVSxRQUFBLFVBQVUsR0FBRztJQUN0Qjs7O09BR0c7SUFDSCxlQUFlLEVBQUU7UUFDYixTQUFTLEVBQVQsVUFBVyxRQUFjO1lBQ3JCLE9BQU8sUUFBUSxDQUFDLElBQUksS0FBSyx3QkFBUyxDQUFDLFlBQVk7Z0JBQzNDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsS0FBSyxLQUFLLENBQUM7UUFDdkQsQ0FBQztRQUNELEVBQUUsRUFBRixVQUFJLFFBQWM7WUFDZCxRQUFRLENBQUMsSUFBSSxHQUFNLHdCQUFTLENBQUMsT0FBTyxDQUFDO1lBQ3JDLFFBQVEsQ0FBQyxNQUFNLEdBQUksOEJBQWUsQ0FBQyxVQUFVLENBQUM7WUFDOUMsUUFBUSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFDeEIsUUFBUSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUMsQ0FBQyxrQkFBa0I7WUFDekMsT0FBTyxRQUFRLENBQUM7UUFDcEIsQ0FBQztLQUNKO0NBQ0osQ0FBQztBQUVGOztHQUVHO0FBQ0gsU0FBZ0IsZUFBZSxDQUFDLFFBQWM7SUFDMUMsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLGtCQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxJQUFJLEVBQUUsR0FBRztRQUNyRCxJQUFNLFNBQVMsR0FBa0Isa0JBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNqRCxJQUFJLFNBQVMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDM0IsS0FBSyxDQUFDLHdCQUFzQixHQUFLLENBQUMsQ0FBQztZQUNuQyxPQUFPLFNBQVMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDN0I7UUFDRCxPQUFPLFFBQVEsQ0FBQztJQUNwQixDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDakIsQ0FBQztBQVRELDBDQVNDIn0=