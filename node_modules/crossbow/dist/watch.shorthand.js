"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var merge = require("../lodash.custom").merge;
var assign = require("../lodash.custom").assign;
function getModifiedWatchContext(trigger) {
    /**
     * First, unwrap each item. If it has a <pattern> -> <task> syntax
     * then we split it, otherwise just return empty arrays for
     * both patterns and tasks
     */
    var unwrapped = trigger.cli.input.slice(1).map(unwrapShorthand);
    /**
     * Next take any items that were split and
     * generate a fake watch options object
     * @type
     */
    var fakeWatchConfig = unwrapped.reduce(function (acc, item) {
        if (item.tasks.length) {
            acc[item.name] = {
                watchers: [{
                        patterns: item.patterns,
                        tasks: item.tasks
                    }]
            };
        }
        return acc;
    }, {});
    trigger.input = merge({}, trigger.input, {
        watch: fakeWatchConfig
    });
    /**
     * Override the CLI input to include the newly split names
     * @type {*[]}
     */
    trigger.cli.input = unwrapped.map(function (x) { return x.name; });
    return trigger;
}
exports.getModifiedWatchContext = getModifiedWatchContext;
/**
 * take the following:
 *  $ crossbow watch "*.js -> (lint) (unit)"
 *
 *  and convert it into
 *  patterns: ["*.js"]
 *  tasks: ["lint", "unit"]
 */
function unwrapShorthand(incoming, i) {
    var patterns = [];
    var tasks = [];
    if (incoming.indexOf(" -> ") > -1) {
        var split = incoming.split(" -> ").map(function (x) { return x.trim(); });
        patterns = split[0].split(":");
        if (split[1]) {
            var _tasks = split[1].match(/\(.+?\)/g);
            if (_tasks) {
                tasks = _tasks.map(function (x) { return x.slice(1, -1).trim(); });
            }
            else {
                tasks = [split[1]];
            }
        }
        return { patterns: patterns, tasks: tasks, i: i, name: "_shorthand_" + i };
    }
    return { patterns: patterns, tasks: tasks, i: i, name: incoming };
}
exports.unwrapShorthand = unwrapShorthand;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2F0Y2guc2hvcnRoYW5kLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3dhdGNoLnNob3J0aGFuZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLElBQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEtBQUssQ0FBQztBQUNoRCxJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxNQUFNLENBQUM7QUFTbEQsU0FBZ0IsdUJBQXVCLENBQUMsT0FBdUI7SUFDM0Q7Ozs7T0FJRztJQUNILElBQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUM7SUFFbEU7Ozs7T0FJRztJQUNILElBQU0sZUFBZSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBQyxHQUFHLEVBQUUsSUFBSTtRQUMvQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFO1lBQ25CLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUc7Z0JBQ2IsUUFBUSxFQUFFLENBQUM7d0JBQ1AsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO3dCQUN2QixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7cUJBQ3BCLENBQUM7YUFDTCxDQUFDO1NBQ0w7UUFDRCxPQUFPLEdBQUcsQ0FBQztJQUNmLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUVQLE9BQU8sQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsS0FBSyxFQUFFO1FBQ3JDLEtBQUssRUFBRSxlQUFlO0tBQ3pCLENBQUMsQ0FBQztJQUVIOzs7T0FHRztJQUNILE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQyxHQUFHLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxFQUFOLENBQU0sQ0FBQyxDQUFDO0lBRS9DLE9BQU8sT0FBTyxDQUFDO0FBQ25CLENBQUM7QUFwQ0QsMERBb0NDO0FBRUQ7Ozs7Ozs7R0FPRztBQUNILFNBQWdCLGVBQWUsQ0FBQyxRQUFnQixFQUFFLENBQVM7SUFDdkQsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO0lBQ2xCLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztJQUVmLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtRQUMvQixJQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBUixDQUFRLENBQUMsQ0FBQztRQUN4RCxRQUFRLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMvQixJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUNWLElBQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDMUMsSUFBSSxNQUFNLEVBQUU7Z0JBQ1IsS0FBSyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFyQixDQUFxQixDQUFDLENBQUM7YUFDbEQ7aUJBQU07Z0JBQ0gsS0FBSyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDdEI7U0FDSjtRQUNELE9BQU8sRUFBQyxRQUFRLFVBQUEsRUFBRSxLQUFLLE9BQUEsRUFBRSxDQUFDLEdBQUEsRUFBRSxJQUFJLEVBQUUsZ0JBQWMsQ0FBRyxFQUFDLENBQUM7S0FDeEQ7SUFDRCxPQUFPLEVBQUMsUUFBUSxVQUFBLEVBQUUsS0FBSyxPQUFBLEVBQUUsQ0FBQyxHQUFBLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBQyxDQUFDO0FBQ2hELENBQUM7QUFsQkQsMENBa0JDIn0=